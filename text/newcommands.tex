\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\prodk}[1]{\prod_{k=1}^K #1}
\newcommand{\prodiN}[1]{\prod_{i=1}^N #1}
\newcommand{\prodjM}[1]{\prod_{j=1}^M #1}
\newcommand{\sumk}[1]{\sum_{k=1}^K #1}
\newcommand{\transpose}[1]{{#1}^{\top}}
\newcommand{\net}[2]{\mathrm{net}_{#1}\left(#2\right)}
\newcommand{\dataset}{\mathcal{D}}
\newcommand{\nchunks}{\mathtt{\#chunks}}
\newcommand{\chunklen}{\mathtt{chunk\_length}}
\newcommand{\randperm}[1]{\mathtt{random\_permutation}\left(\left\{#1\right\}\right)}
\newcommand{\chunk}{\mathtt{chunk}}
\newcommand{\datapoint}{\mathtt{datapoint}}
\newcommand{\Z}{\mathbf{Z}}\

\newcommand{\z}[1]{\mathbf{z}_{#1}}
\newcommand{\pz}[2]{p_{\z{#1}}\left(#2\right)}
\newcommand{\Fz}[2]{F_{\z{#1}}\left(#2\right)}
\newcommand{\Pleq}[2]{P\left(#1 \leq #2\right)}
\newcommand{\tr}{\mathcal{T}}
\newcommand{\normal}[3]{\mathcal{N}\left(#1|#2,#3\right)}
\newcommand{\Rij}{R_{ij}}
\newcommand{\Ui}{U_i}
\newcommand{\Uit}{\transpose{U_i}}
\newcommand{\Vj}{V_j}
\newcommand{\Iij}{I_{ij}}
\newcommand{\Enc}[1]{\mathrm{Enc}\left(#1\right)}
\newcommand{\Dec}[1]{\mathrm{Dec}\left(#1\right)}
\newcommand{\trinv}[1]{\tr^{-1}\left(#1\right)}
\newcommand{\multipartial}[1]{\frac{\partial}{\partial{\z{#1}}_1 \cdots \partial{\z{#1}}_n}}
\newcommand{\deriv}[2]{\frac{\partial #1}{\partial #2}}
%\newcommand{\det}{\mathrm{det}}

% previous style for derivative of transformations:
%\newcommand{\detDtr}[1]{\det D\tr\left(#1\right)}
%\newcommand{\detDtrinv}[1]{\det D\trinv{#1}}

% new style for derivative of transformations:

\newcommand{\derivtk}[1]{\deriv{t_k\left(#1\right)}{#1}}
\newcommand{\Dtr}[1]{\deriv{\tr\left(#1\right)}{#1}}
\newcommand{\Dtrinv}[1]{\deriv{\trinv{#1}}{#1}}
\newcommand{\detDtr}[1]{\det \Dtr{#1}}
\newcommand{\detDtrinv}[1]{\det \Dtrinv{#1}}

\newcommand{\bk}{b_k}
\newcommand{\bolda}{\mathbf{a}}
\newcommand{\boldat}{\transpose{\bolda}}
\newcommand{\boldb}{\mathbf{b}}
\newcommand{\boldbt}{\transpose{\boldb}}
\newcommand{\boldA}{\mathbf{A}}
\newcommand{\boldAinv}{\boldA^{-1}}
\newcommand{\boldw}{\mathbf{w}}
\newcommand{\boldwk}{\mathbf{w}_k}
\newcommand{\boldx}{\mathbf{x}}
\newcommand{\boldX}{\mathbf{X}}
\newcommand{\boldu}{\mathbf{u}}
\newcommand{\bolduk}{\mathbf{u}_k}
\newcommand{\boldz}{\mathbf{z}}
\newcommand{\boldr}{\mathbf{r}}
\newcommand{\boldrk}{\boldr_k}
\newcommand{\boldm}{\mathbf{m}}
\newcommand{\boldmk}{\boldm_k}
\newcommand{\boldZ}{\mathbf{Z}}
\newcommand{\xij}{x^{(i)}_j}
\newcommand{\boldxi}{{\boldx^{(i)}}}
\newcommand{\boldxone}{{\boldx^{(1)}}}
\newcommand{\boldxN}{{\boldx^{(N)}}}
\newcommand{\boldzi}{{\boldz^{(i)}}}
\newcommand{\boldzone}{{\boldz^{(1)}}}
\newcommand{\boldZminusone}{{\boldZ_{-(1)}}}
\newcommand{\boldXminusone}{{\boldX_{-(1)}}}
\newcommand{\boldzkminusone}{{\boldz_{k-1}}}
\newcommand{\boldzN}{{\boldz^{(N)}}}
\newcommand{\freeenergyxi}{\mathcal{F}\left(\boldxi\right)}
\newcommand{\elboxi}{\mathcal{L}\left(\boldxi\right)}
\newcommand{\elboX}{\mathcal{L}\left(\boldX\right)}
\newcommand{\expect}[2]{\mathbb{E}_{#1}\left[ #2 \right]}
\newcommand{\zcondi}{\boldz|\boldxi}
\newcommand{\zcond}{\boldz|\boldx}
\newcommand{\qphizcondi}{q_\phi\left(\zcondi\right)}
\newcommand{\qphiZ}{q_\phi\left(\boldZ|\boldX\right)}
\newcommand{\expectqphi}[1]{\expect{\qphizcondi}{#1}}
\newcommand{\expectqphiZ}[1]{\expect{\qphiZ}{#1}}
\newcommand{\qphizi}{\qphi{\boldzi|\boldxi}}
\newcommand{\expectqphizi}[1]{\expect{\qphizi}{#1}}
\newcommand{\ptheta}[1]{p_\theta\left(#1\right)}
\newcommand{\pjointi}{\ptheta{\boldxi,\boldz}}
\newcommand{\logpjointi}{\log \pjointi}
\newcommand{\qphi}[1]{q_\phi\left(#1\right)}
\newcommand{\qzcondi}{\qphi{\zcondi}}
\newcommand{\qzcond}{\qphi{\zcond}}
\newcommand{\logqzcondi}{\log \qzcondi}
\newcommand{\pxicond}{\ptheta{\boldxi|\boldz}}
\newcommand{\pxcond}{\ptheta{\boldx|\boldz}}
\newcommand{\pzcond}{\ptheta{\zcond}}
\newcommand{\pxicondi}{\ptheta{\boldxi|\boldzi}}
\newcommand{\pxizi}{\ptheta{\boldxi,\boldzi}}
\newcommand{\pXcond}{\ptheta{\boldX|\boldZ}}
\newcommand{\pXZ}{\ptheta{\boldX,\boldZ}}
\newcommand{\pX}{\ptheta{\boldX}}
\newcommand{\pZ}{\ptheta{\boldZ}}
\newcommand{\pzi}{\ptheta{\boldzi}}
\newcommand{\pthetaz}{\ptheta{\boldz}}
\newcommand{\pzone}{\ptheta{\boldzone}}
\newcommand{\qphizone}{\qphi{\boldzone|\boldxone}}
\newcommand{\qphiZminusone}{\qphi{\boldZminusone|\boldXminusone}}
\newcommand{\pZminusone}{\ptheta{\boldZminusone}}
\newcommand{\qphizN}{\qphi{\boldzN|\boldxN}}
\newcommand{\pZcond}{\ptheta{\boldZ|\boldX}}
\newcommand{\logpxicond}{\log \pxicond}
\newcommand{\logpz}{\log \pthetaz}
\newcommand{\boldzzero}{\boldz_0}
\newcommand{\boldxzero}{\boldx_0}

\newcommand{\qzero}{q_0\left(\boldzzero|\boldx\right)}
\newcommand{\qzeroinvtr}{q_0\left(\trinv{\boldz}\right)}
\newcommand{\expectqzero}[1]{\expect{\qzero}{#1}}

\newcommand{\trzzero}{\tr\left(\boldzzero\right)}
\newcommand{\pxicondtr}{\ptheta{\boldxi|\trzzero}}
\newcommand{\logpxicondtr}{\log \pxicondtr}
\newcommand{\ptrzzero}{\ptheta{\tr(\boldzzero)}}
\newcommand{\logptr}{\log \ptrzzero}

\newcommand{\entropysymbol}{\mathbb{H}}
\newcommand{\entropy}[1]{\entropysymbol\left[#1\right]}
\newcommand{\entropyp}[2]{\entropysymbol_{#1}\left[#2\right]}
\newcommand{\entropyqzcondi}{\entropyp{q_\phi}{\boldz|\boldxi}}

\newcommand{\entropyqzero}{\entropyp{q_0}{\boldzzero|\boldx}}
\newcommand{\wt}{\transpose{\boldw}}
\newcommand{\wtk}{\transpose{\boldw}_k}

\newcommand{\RD}{\mathbb{R}^D}

\newcommand{\partialboldz}[1]{\frac{\partial #1}{\partial \boldz}}
\newcommand{\identity}{\mathbf{I}}
\newcommand{\half}{\frac{1}{2}}
\newcommand{\diffximutheta}{\left(\boldxi - \boldsymbol\mu_\theta\right)}
\newcommand{\diffxijmuthetaj}{\left(\xij - \mu_{\theta j}\right)}
\newcommand{\diffTxizerotheta}{\left(\tr(\boldzzero) - \mathbf{0}\right)}
\newcommand{\ltwonorm}[1]{||#1||_2^2}
\newcommand{\kl}[2]{\mathbb{KL}\left[ #1 || #2 \right]}
\newcommand{\justkl}{\mathbb{KL}}

\newenvironment{nalign}{
    \begin{equation}
    \begin{aligned}
}{
    \end{aligned}
    \end{equation}
    \ignorespacesafterend
}

\newcommand{\sumiN}{\sum_{i=1}^N}

\newcommand{\integral}[2]{\int_{#1} #2 \mathrm{d}#1}
