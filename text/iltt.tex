\section{Planar Transformations}\label{iltt}

It has been proposed\cite{1505.05770} to achive a more complex 
posterior approximation
by using a type of transformations with the following form:

\begin{nalign}
t(\boldz) = \boldz + \boldu h(\wt \boldz + b)
\end{nalign}

This transformation can be applied to a simpler distribution,
such as the diagonal-covariance gaussian
introduced in \cite{1312.6114}.

The parameters are: $b$ which is a scalar, 
$\wt \in \RD$ and $\boldu \in \RD$;
$h$ is an element-wise nonlinearity,
such as a sigmoid $h(a) = \frac{1}{1+e^{-a}}$.


The expression $\wt \boldz + b$ is a scalar value,
and $h(\wt \boldz + b)$ can be seen as one perceptron layer
with a single output unit. 
$\boldu$ is a parameter that acts as a coefficient vector
representing the amount of the transformation $h(\wt \boldz + b)$
applied to the input $\boldz$ vector.

The previous derivations showed how just the 
determinant of Jacobian of the transformation
is used in order to express the probability of the transformed variable
as a function of the probability of the original variable $\boldzzero$.

The Jacobian $\partialboldz{t(\boldz)}$ of the transformation can be found as follows:

\begin{nalign}
\partialboldz{\boldz} &= \identity \\
\partialboldz{\wt \boldz + b} &= \wt && \text{The Jacobian of a scalar is a row vector} \\
\partialboldz{h(\wt \boldz + b)} &= h^\prime (\wt \boldz + b)\wt && \text{Chain rule}
\end{nalign}

Hence:
\begin{nalign}
\partialboldz{t(\boldz)} &= \identity + \boldu h^\prime(\wt \boldz + b)\wt
\end{nalign}

In order to derive the determinant of the Jacobian, it's possible to make use of the
\emph{matrix determinant lemma} which states:
\begin{nalign}
    \det ( \boldA + \bolda \boldbt ) = (1 + \boldbt \boldAinv \bolda)(\det \boldA)
\end{nalign}

Considering $\boldA = \identity$, $\bolda = \boldu$ and $\boldbt = h^\prime(\wt \boldz + b)\wt$,
this leads to:

\begin{nalign} \label{detjacobian_iltt}
\det \partialboldz{t(\boldz)} &= \det(\identity + \boldu h^\prime(\wt \boldz + b) \wt)\\ 
&= (1 + h^\prime(\wt \boldz + b)\wt \identity^{-1} \boldu)(\det \identity)\\
 &=1 + h^\prime(\wt \boldz + b)\wt \boldu
\end{nalign}

